<?xml version="1.0" ?> 
  <table xmlns="http://query.yahooapis.com/v1/schema/table.xsd">
  <meta>
  <author>Vic Mortelmans</author> 
  <description>Weather - frost alert</description> 
  <documentationURL></documentationURL> 
  </meta>
  <bindings>
  <select produces="XML" itemPath="">
  <inputs>
  <key id="location" type="xs:string" paramType="query" required="true" /> 
  <key id="language" type="xs:string" paramType="query" required="false" /> 
  </inputs>
  <execute>
  <![CDATA[ 
    if (!language) {
      language = 'en';
    }
    //var url = "http://www.google.com/ig/api?weather=$location";
    var url = "http://pipes.yahoo.com/pipes/pipe.run?_id=70a400f5404b6a454caf850de3f62d33&_render=json&location=$location";
    url = url.replace(/\$location/,encodeURI(location));
    //var query = "select * from xml where url='$url'";
    var query = "select * from json where url='$url' and itemPath='//tempMinC'";
    query = query.replace(/\$url/,url);
    xml = y.query(query).results.*;
    y.log(xml);
    var seq = new String();
    //for each (var lowtemp in xml..forecast_conditions.low.@data) {
    for each (var lowtemp in xml..tempMinC) {
      //seq += (lowtemp > 32 ? '+' : '-');
      seq += (lowtemp > 0 ? '+' : '-');
    }
    seq = seq.substr(0,3);
    var output = new String();
    switch (seq) {
    case "+++":
      output = "De dooi houdt aan in $location";
      break;
    case "++-":
      output = "Overmorgen gaat het vriezen in $location";
      break;
    case "+-+":
    case "+--":
      output = "Morgen gaat het vriezen in $location";
      break;
    case "---":
    case "-+-":
    case "--+":
      output = "Het blijft vriezen in $location";
      break;
    case "-++":
      output = "Morgen gaat het dooien in $location";
      break;
    }
    output = output.replace(/\$location/,location);
    query = "select * from google translate where q='$text' and target='$language'";
    query = query.replace(/\$text/,output);
    query = query.replace(/\$language/,language);
    output = y.query(query).results.translatedText.toString();
    response.object = <frost>{output}</frost>;
  ]]> 
  </execute>
  </select>
  </bindings>
  </table>
